class e{constructor(e,t){this.load(e,t)}abort(){this.reader.cancel()}async load(e,n){let r=await fetch(e);this.reader=r.body.getReader();let o=[],c={url:e,typ:r.headers.get("Content-Type"),len:1*r.headers.get("Content-Length"),enc:r.headers.get("Content-Encoding"),rec:0,dat:!1,start:t()};for(;;){const{done:e,value:t}=await this.reader.read();if(e)break;o.push(t),c.rec+=t.length,c.chunk=t,n&&n(c)}let a=new Uint8Array(c.rec),l=0;for(let e of o)a.set(e,l),l+=e.length;c.dat=a,c.end=t(),c.dur=c.end-c.start,c.bps=8*c.len/c.dur,n&&n(c)}}function t(){return performance.timeOrigin+performance.now()}const n=[];let r;const o={background:!0,fullscreen:!0,abort:e=>{a(e)},loadURL:async(t,r)=>{c();const o=new e(t,(e=>{l(e.chunk,e.rec,e.len,e.enc,e.prot),r&&r(e),e.dat&&a(o)}));n.push(o)}};function c(){if(document.getElementById("copperbars"))return;const e=document.createElement("canvas");e.id="copperbars";const t=o.background?-604:604;e.style="position:absolute;top:"+scrollY+"px;left:0;width:100%;height:100%;image-rendering:pixelated;z-index:"+t+";",onscroll=t=>{e.style.top=scrollY+"px"},document.getElementById("copperbars")||document.body.appendChild(e),r=e.getContext("2d",{alpha:!o.background})}function a(e){if(e){e.abort();const t=n.indexOf(e);n.splice(t,1)}0===n.length&&document.getElementById("copperbars")&&document.body.removeChild(document.getElementById("copperbars"))}function l(e,t,n,c,a){let l=d(1,200,t/n);"br"===c&&(l=r.canvas.clientHeight/2),"gzip"===c&&(l=r.canvas.clientHeight/3),l>e.length/3&&(l=e.length/3),r.canvas.width=l,r.canvas.height=l;for(let t=0,n=0;t<l;t++){const o="rgb("+e[n++]+", "+e[n++]+", "+e[n++]+")";r.strokeStyle=o,r.beginPath(),r.moveTo(0,t),r.lineTo(l,t),r.stroke()}o.fullscreen||r.clearRect(.05*l,.05*l,.9*l,.9*l)}function d(e,t,n){return(1-n)*e+n*t}export{o as LDR};